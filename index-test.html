<!DOCTYPE html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1"> 
<title>EventFinder</title>
<link rel="stylesheet" href="css/jquery.mobile.css" type="text/css" >
<link rel="stylesheet" href="css/main.css" type="text/css">

<script src="http://code.jquery.com/jquery-1.8.2.min.js"></script>
<script src="js/jquery.mobile.js"></script>
<script src="js/locations.js"></script>
<!-- <script src="js/infobox.js"></script>
<script src="js/markercluster.js"></script> -->
<script type="text/javascript" src="http://maps.google.com/maps/api/js?v=3.exp&sensor=false"></script>
<script type="text/javascript">
var infowindow = null;
    $(document).ready(function () { initialize();  });

    var geocoder;
    var map;
    function initialize() {
      geocoder = new google.maps.Geocoder();
      var latlng = new google.maps.LatLng(37.8656259, -122.253672);

      var mapOptions = {
        zoom: 13,
        center: latlng,
        mapTypeId: google.maps.MapTypeId.ROADMAP
      }

      map = new google.maps.Map(document.getElementById('map_canvas'), mapOptions);

      setMarkers(map, sites);
      infowindow = new google.maps.InfoWindow({
              content: "loading..."
      });
    }

    function setMarkers(map, markers) {

        for (var i = 0; i < markers.Locations.length; i++) {
            var sites = markers.Locations[i];
            var contentString = 
              '<div id="infoWin">'+
            '<div id="siteNotice">'+
            '</div>'+
            '<h3 class="infoWin-head">'+ sites[1] + '</h3>'+
            '<div class="infoWin-content">'+
              '<p>' + sites[2] + '</p>' + 
            '</div>'+
            '<div>' +
              '<div>' + 
                '<span class="up-btn vote"></span>' + 
              '</div>' + 
              '<div>' + 
                '<span class="down-btn vote"></span>' +
              '</div>' +
            '</div>' +
            '</div>';
            var siteLatLng = new google.maps.LatLng(sites[12], sites[13]);
            var marker = new google.maps.Marker({
                position: siteLatLng,
                map: map,
                title: sites[1],
                zIndex: sites[0]+1,
                html: contentString
            });

            google.maps.event.addListener(marker, "click", function () {
                infowindow.setContent(this.html);
                infowindow.open(map, this);
            });
        }
    }

    function codeAddress(address) {
        geocoder.geocode( { 'address': address}, function(results, status) {
          if (status == google.maps.GeocoderStatus.OK) {
            map.setCenter(results[0].geometry.location);
          } else {
            alert('Geocode was not successful for the following reason: ' + status);
          }
        });
      };
</script>

</head>

<body onLoad="initialize()">

<div data-role="page" id="home">
	<div data-role="header" data-id="header" data-position="fixed" class="ui-header ui-bar" id="header-bar">
		<h1>EventFinder</h1>
		<a href="index.html" id="filter-icon" class="ui-btn-right"></a>
	</div>

	<div data-role="content">
		<input type="search" name="search-mini" id="address1" placeholder="Search" />
		<input type="button" id="search-button" value="Search" data-inline="true" class="search-btn" data-ref="1" />

		<div id="map_canvas" style="width: 100%; height: 400px;">

		</div>	
	</div>

	<div data-role="footer" data-id="footer1" data-position="fixed" class="ui-footer">
		<div data-role="navbar" class="ui-navbar" role="navigation">
			<ul>
				<li class="btn-active"><a href="#" class="ui-state-persist" id="map1">Map</a></li>
				<li><a href="#two" class="ui-state-persist" id="list1">List</a></li>
			</ul>
		</div>
	</div>
</div>

<div data-role="page" id="two">

  <div data-role="header" data-id="header" data-position="fixed" class="ui-header ui-bar" id="header-bar">
    <h1>EventFinder</h1>
    <a href="index.html" id="filter-icon" data-icon="gear" class="ui-btn-right"></a>
  </div>

  <div data-role="content" data-theme="a">
    <div id="search-fields">
      <input type="search" name="search-mini" id="address2" value placeholder="Search" />
      <input type="button" id="search-button" value="Search" data-inline="true" data-ref="2" class="search-btn" />
    </div>
    <div style="margin-top:20px;">
      <h2 class="search-results"></h2>
      <ul data-role="listview" class="list-results">
      </ul>
    </div>
  </div><!-- /content -->
  
  <div data-role="footer" data-id="footer1" data-position="fixed" class="ui-footer">
    <div data-role="navbar" class="ui-navbar" role="navigation">
      <ul>
        <li><a href="#home" class="ui-state-persist" id="map2">Map</a></li>
        <li class="btn-active"><a href="#" class="ui-state-persist" id="list2">List</a></li>
      </ul>
    </div>
  </div>
</div>
<script type="text/javascript">
$(document).on('pageinit',function(){
  $( ".search-btn" ).bind( "click", function(event, ui) {
    var refBtn = $(this).data("ref");
    var queryTerm = $('#address'+refBtn).val()
    codeAddress(queryTerm);
    var resultsHead = 'Results for "'+ queryTerm +'"';
    $('.search-results').empty().append(resultsHead);

    $('.list-results').empty();

    for (var i = 0; i < sites.Locations.length; i++) {

      var eventSpot = sites.Locations[i];

      var content = '<li class="ui-btn ui-btn-icon-right ui-li-has-arrow ui-li ui-li-last ui-btn-up-a" data-corners="false" data-shadow="false" data-iconshadow="true" data-wrapperels="div" data-icon="arrow-r" data-iconpos="right" data-theme="a">'+ 
      '<div class="ui-btn-inner ui-li">'+ 
      '<div class="ui-btn-text">'+'<div class="list-item">'+'<h4>'+eventSpot[1]+'</h4>'+ '<p>'+eventSpot[2]+'</p>'+'</div>'+'</div>'+'<span class="ui-icon ui-icon-arrow-r ui-icon-shadow">'+'</span>'+'</div>'+'</li>'; 
      $('.list-results').append($(content));
    }
  });

  $('#map2').bind("click", function(event, ui){
    $('#address1').val($('#address2').val());
  });

  $("#list1").bind("click", function(event, ui){
    $('#address2').val($('#address1').val());
  });

  $('#address2').val($('#address1').val());

});

</script>

</body>
</html>